#!/usr/bin/env bash
set -e

RUN_ARTIFACT_DIR="target"

FRAMEWORK_BASE_DIR='sfdx-source/framework'

FRAMEWORK_MODULE_DIR="${FRAMEWORK_BASE_DIR}/${FRAMEWORK_MODULE_NAME}"

if [ -z "$FRAMEWORK_ORIGINAL_SOURCE_DIR" ];
then
    FRAMEWORK_ORIGINAL_SOURCE_DIR=${FRAMEWORK_MODULE_NAME}
fi


if [ -d "$FRAMEWORK_MODULE_DIR" ];
then
    rm -f -R "${FRAMEWORK_MODULE_DIR}"
fi

if [ -d "$RUN_ARTIFACT_DIR" ]; 
then
    rm -f -R "${RUN_ARTIFACT_DIR}"
fi

mkdir -p "${RUN_ARTIFACT_DIR}"

git clone ${FRAMEWORK_MODULE_GITHUB} ${RUN_ARTIFACT_DIR}

cp -R ${RUN_ARTIFACT_DIR}/${FRAMEWORK_ORIGINAL_SOURCE_DIR} ${FRAMEWORK_MODULE_DIR}

if [ -d "$RUN_ARTIFACT_DIR" ]; 
then
    rm -f -R "${RUN_ARTIFACT_DIR}"
fi